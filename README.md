つくりたいものは、1人以上のメンバーの知識から知識をつなげて、ネットサーフィンのように知識を探索・発見・共鳴・触発しあうコミュニティです。

このコミュニティでは二種類の場を提供します。

## 場の種類
1. 共同知識スペース
2. 個人知識スペース

### 共同知識スペース
共同知識スペースは、コミュニティメンバー全員がアクセスできる場です。
- コミュニティのGitHubアカウントでリポジトリをもちます。
- メンバーはここで知識を共有し、共同で編集・更新できます。
- 共同知識スペースでは、メンバー同士が意見交換やディスカッションを行い、知識の深化を図ります。
- 共同知識スペースは、コミュニティ全体の知識ベースとして機能します。
- 基本的にプルリクエストや提案を通じて編集が行われます。

### 個人知識スペース
個人知識スペースは、各メンバーが自分のペースで知識を整理・編集できる場です。
- メンバーは自分のGitHubアカウントで任意の名前のリポジトリをもち、個人知識スペースを管理します。
- メンバーはここで自分のアイデアや知識を自由に表現できます。
- 個人知識スペースでは、メンバーが自分の興味や関心に基づいて知識を深めることができます。
- 個人知識スペースは、メンバーの個別の知識ベースとして機能します。
- メンバーは自分のスペースを自由にカスタマイズできます。
- 個人知識スペースで得た知識やアイデアを、必要に応じて共同編集スペースに反映させることも可能です。
- 個人知識スペースはプライベートかどうかを記事毎、タイプ毎に設定できます。
- プライベート設定された記事やタイプは、他のメンバーからは閲覧・編集できません。
- プライベート設定はいつでも変更可能で、メンバーは自分の知識管理を柔軟に行えます。

---

# アーキテクチャ概要

メンバーが操作するインターフェイスとして [Obsidian](https://obsidian.md/) を利用します。
メンバーが作成する知識はすべて Markdown ファイルに記述されます。
個人知識スペースの管理、共同知識スペースの編集、他のメンバーとの公開知識の同期には Git と GitHub を用います。

Git を利用しますが、参加者は Git の知識がなくても利用できるようにします。
メンバーは Obsidian 上で知識の作成、編集、他のメンバーの知識の閲覧を行いますが、メンバーの行うことは push と pull のみで、その他のバックエンドに当たる処理は GitHub Actions で行います。push された記事の整形には Markdown 用のテーマを適用した Hugo を利用します。

## リポジトリの種類（概観）
このコミュニティでは大きく分けて三種類のリポジトリを持ちます。

- コミュニティのアカウント / 共同知識スペース
  - 共同知識スペースを管理するためのリポジトリ（コミュニティに1つ）。
- コミュニティのアカウント / 個人知識スペース用テンプレートリポジトリ
  - メンバーはこのテンプレートから個人知識スペースを作成する（コミュニティに1つ）。
- メンバーのアカウント / 個人知識スペース
  - 各メンバーが所有する個人のリポジトリ（メンバー数分）。

---

## 個人知識スペース用テンプレート — 推奨ディレクトリ構成
以下はテンプレートリポジトリに含めることを想定したディレクトリ構成です。

- `.obsidian/`
  - Obsidian の設定ファイル群。PC 版と mobile 版の共通設定をここに置きます。mobile 版は機能制限があるため注意。
  - 中身のファイルは必要最小限を Git 管理します。
- `.obsidian-pc/`
  - プラグインの JS 本体などをシンボリックリンクで管理する想定。クロスプラットフォーム互換性のため、clone 後にスクリプトでシンボリックリンクを貼る仕組みを利用しても良い。
- `_Attachments/` — バイナリファイル格納
  - `Images/` — 写真、画像、動画など
    - この下位に 16 進数 1 文字フォルダ（16個）→その下に 16 進数 2 文字フォルダ（256個）を用意し、最終的に md5 ハッシュしたファイル名でバイナリを格納します。
    - バイナリと同名（basename + 拡張子 + `.md`）のメタ情報 Markdown を同階層に置きます。
    - ハッシュ化とメタ Markdown の生成は GitHub Actions 側で行う想定です。ハッシュ化前のバイナリは `_Attachments/Temp/` に一旦置かれます。
    - Vault 内の *.md がバイナリへのリンクを保持しているはずなので、Actions で新しいハッシュ化後のファイル名へリンクを書き換える必要があります。
- `_Share/` — コミュニティ共通領域
  - `Common/` — コミュニティ共通設定
  - `Collective/` — 共有知識スペース
  - `Datastore/`
  - `Members/` — 他メンバーの `public/` 以下の記事のみ格納（読み取り専用）
  - `Public/` — 他メンバーに公開する記事を格納（Actions により生成）
  - `Publish/` — GitHub Pages 等の公開用に生成される記事ソース
  - `Build/` — Hugo 関連ファイル（テーマ、config など）
- `_Config/` — ローカルで `_Share/Common` の設定を上書きできる領域（Git 管理）
  - `Cache/` — キャッシュ（`.gitkeep` のみを格納）
  - `Archetypes/` — 新規記事テンプレート
  - `Properties/` — FrontMatter の初期値等を制御するファイル群
  - `Settings/`
    - `Settings.md` — 新規作成されるファイルについての設定（共通設定の上書き）
    - `SyncFilters.md` — `Members` 配下にコピーされる他メンバーのリポジトリを自分のリポジトリにコピーするか制御する

---

## 分散型Obsidian Vault連携システム — アーキテクチャ概要

本システムは、複数の参加者（メンバー）が自身のObsidian Vaultで協調作業を行い、公開コンテンツのID管理とリンクの整合性をグループ共通リポジトリの GitHub Actions によって一元的に制御するための分散型アーキテクチャです。

### システム構成要素（3層構造）

システムは、参加者のローカル Vault、ID 管理を担当する共通データストア、および自動処理層から構成されます。

| 構成要素 | 役割 | 備考 |
|---|---|---|
| ローカル Vault | 参加者の作業空間。新規ファイル作成、編集、コミットを行う。 | TemplaterJS（Step 1〜5）が実行されるクライアント層。 |
| 共通リポジトリ | IDマップ (ID_Lookup/) などのデータストア、および共同編集記事のマスターソース。 | 唯一のID書き込み権限を持つ中央集権的な層。 |
| GitHub Actions | サーバーサイドでの自動処理。公開コンテンツの生成、IDマップ更新、リンクの自動修正、共同編集記事のPR作成を担当。 | システムの整合性維持機構。 |

### ブランチ戦略（参加者リポジトリ）

参加者がブランチ戦略を意識しないよう、`develop` を日常の作業ブランチとし、`main` は保護された最終成果物ブランチとします。

| ブランチ名 | 役割 | 権限設定（必須） | 参加者の操作 |
|---|---|---:|---|
| develop | 日常作業・自動修正ブランチ。参加者のプッシュを受け入れ、Actionsによる自動修正コミットがここに格納される。 | 参加者、Actionsからの書き込みを許可。 | ここに直プッシュする（他のブランチ操作は不要）。 |
| main | Web公開・最終成果物ブランチ。常に安定した状態を保つ。 | **ブランチ保護を設定し、Actionsからのマージのみ許可。** 手動プッシュは禁止。 | 意識しない（Actionsが自動管理）。 |
| hotfix/<topic> | 緊急修正。main から派生し、修正後 main および develop にマージされる。 | 権限者のみ書き込み、PR作成を許可。 | 緊急時にのみ利用。 |
| times/<topic> | 即時投稿。main から派生し、軽量なチェック後 main および develop にマージされる。 | 権限者のみ書き込み、PR作成を許可。 | 即時公開を要する記事に利用。 |

---

## Vault内ディレクトリ構造と役割

公開範囲と管理主体に応じて、ファイルパスが厳密に分けられています。

| パス | 役割 | 管理主体 | 正規化 |
|---|---|---|---|
| `_Share/Public/Web/` | Web公開用の最終成果物。短縮URLはこのパスを参照する。 | GitHub Actions (生成と書き込み) | Actionsにより `@ID` 付与 |
| `_Share/Public/Member/` | メンバー間同期用のソース。他のメンバーの Vault に同期される。 | GitHub Actions (生成と書き込み) | Actionsにより `@ID` 付与 |
| `_Share/Members/{ID}/Public/` | 他のメンバー の公開コンテンツ。`_Share/Public/Member/` の内容を外部から同期する。 | 外部からの同期（読み取り専用） | Actionsにより `@ID` 付与 |
| `_Share/Common/Datastore/` | IDマップ (ID_Lookup/) などのシステムデータ。 | 共通リポジトリ Actions | 読み取り専用 |
| `_Share/Common/Docs/` | グループ共通の共同編集記事。共通リポジトリから同期する。 | 共通リポジトリ（読み取り/編集PR提出） | Actionsにより `@ID` 付与 |
| `_Sys/` | システム設定、Archetype、キャッシュ | ローカル Vault の管理ファイル | なし |
| 作業ディレクトリ | 参加者が直接編集する非公開の記事ソース（例: `Notes/`, `Drafts/` など）。 | 参加者自身 | なし |
| 作業ディレクトリ (一時的) | `Inbox/Times/` | 参加者が一時的にファイルを置き、Actionsが自動で `times` ブランチに切り出すためのキュー。 | なし |

---

## 処理フローと整合性維持のメカニズム

（中略：詳細は元ドキュメントに従う）

---

## 補足・運用上の注意（ベストプラクティス）

- ローカル側は ID の衝突判定のため、定期的に最新の `ID_Lookup` を取得しておくこと。可能なら TemplaterJS の実行時に `ID_Lookup` をフェッチする処理を組み込む。
- Actions 側の自動修正は「読み取り専用のワークフロー」で始め、想定外の書き換えが発生した場合は通知（例：PR、Issue、Slack）を出す。
- `main` の自動マージ前に必須のチェック（静的チェック、フォーマット、簡易リンク検証）を入れることで、公開品質を担保する。
- 共同編集 PR（`_Share/Common/Docs/`）には、レビュープロセスとコンフリクト解消のルールを明文化しておくと良い。
- times / hotfix フローは権限管理を厳格にし、誤った即時公開を防ぐ。

---

## 次の推奨アクション

- GitHub Actions ワークフロー（ID 生成/解決、リンク書換、times 切り出し、Publish） のテンプレートを作成する。
- ID_Lookup の JSON/Markdown フォーマット仕様を定める。
- テストシナリオ（ID 重複、リンク更新、times 切り出し、コンフリクト時の挙動）を作成し CI で検証する。

---


作成日: 2025-11-14
